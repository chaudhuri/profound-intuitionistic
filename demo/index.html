<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <!-- START icons -->
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <!-- END icons -->
    <title>Profint Launcher</title>
    <!-- jquery -->
    <script src="vendor/jquery.min.js"></script>
    <!-- katex -->
    <link rel="stylesheet" href="vendor/katex.min.css">
    <script src="vendor/katex.min.js"></script>
    <!-- ace -->
    <script src="vendor/ace.js"></script>
    <script src="vendor/hotkeys.min.js"></script>
    <!-- profint -->
    <script src="ora.bc.js"></script>
    <script>
      const macros = {
          "\\o": "\\mathsf{o}",
          "\\i": "\\mathsf{i}",
      };

      const katex_options = {
          trust: true,
          output: 'html',
          strict: false,
          macros
      }

      function makeCompact(str) {
        return str.replaceAll(/s+/g, " ").trim();
      }

      function makeURL(sigText, formText) {
        const f = encodeURIComponent(makeCompact(formText));
        const s = encodeURIComponent(makeCompact(sigText));
        return `go.html?s=${s}&f=${f}`;
      }

      const premadeSignature = makeCompact(
        String.raw`
i : \type.
f : i -> i.
g : i -> i -> i.
j, k : i.
a, b, c : \o.
p, q : i -> \o.
r : i -> i -> \o.
`);

      $(document).ready(function(){
        profint.signatureChange(premadeSignature);
        $("#premade li").each(function(){
          const formulaText = $(this).text();
          const url = makeURL(premadeSignature, formulaText);
          const formulaExpr = profint.formulaToHTML(formulaText);
          const html = katex.renderToString(formulaExpr, katex_options);
          let anc = $('<a>').attr('href', url).html(html);
          $(this).empty().append(anc);
        });
      });
    </script>
    <style>
      body {padding-left: 40px; padding-top: 40px;}
      a {text-decoration: none;}
      /* #signature {margin: 0; position: fixed; left: 80%; top: 0; right: 0;} */
      .embed-editor { padding: 1px 1vh; background-color: black; }
      #maincontent {
          display: flex; gap: 4vh;
          width: 100%;
          align-items: flex-start;
          margin: 0; padding: 0;
      }
      #maincontent > * {
          padding: 2vh 4vh;
          background-color: #eee;
      }
      #premade { flex-grow: 1; }
      #yourown { flex-grow: 2; }
      #custom-launch { margin-top: 2vh; font-size: 140%; }
    </style>
  </head>
  <body>
    <h1>Profound&ndash;Intuitionistic</h1>

    <div id="maincontent">
      <div id="yourown">
        <h2>State your conjecture:</h2>

        <div class="embed-editor">
          <pre id="signature">
i : \type.
f : i -> i.
p : i -> \o.</pre>
        </div>

        <hr>

        <div class="embed-editor">
          <pre id="formula">(\A [x] p x => p (f x)) => \A [u] p u => p (f (f u))</pre>
        </div>
        <div style="margin:1vh auto;margin-left:2em;">
          <em>i.e.,</em> <span id="conjecture-output"></span>
        </div>
        <button id="custom-launch">Launch!</button>

        <script>
          var sigEditor = ace.edit("signature");
          sigEditor.setTheme("ace/theme/twilight");
          sigEditor.setOptions({
            minLines: 3,
            maxLines: 20,
            showLineNumbers: false,
            showGutter: false,
          });
          var formEditor = ace.edit("formula");
          formEditor.setTheme("ace/theme/twilight");
          formEditor.setOptions({
            minLines: 1,
            maxLines: 5,
            showLineNumbers: false,
            showGutter: false,
          });
          const isOk = {
            sig: true,
            form: true,
          };
          function updateBordersAndButtons() {
            $("#signature").parent()
              .css({ border: isOk.sig ? "none" : "2px solid red" });
            $("#formula").parent()
              .css({ border: isOk.form ? "none" : "2px solid red" });
            const allOk = isOk.sig && isOk.form;
            $("#custom-launch").prop("disabled", !allOk);
            return allOk;
          }
          function formEditorUpdate(e) {
            const formExpr = profint.formulaToHTML(formEditor.getValue());
            isOk.form = false;
            if (formExpr) {
              isOk.form = true;
              const htmlStr = katex.renderToString(formExpr, katex_options);
              $('#conjecture-output').html(htmlStr);
            }
            return updateBordersAndButtons();
          }
          function sigEditorChange(e) {
            isOk.sig = !!profint.signatureChange(sigEditor.getValue());
            return formEditorUpdate();
          }
          formEditor.on("change", sigEditorChange);
          sigEditor.on("change", sigEditorChange);
          sigEditorChange();
          $("#custom-launch").on("click", function(ev) {
            const url = makeURL(sigEditor.getValue(), formEditor.getValue());
            // console.log("Need to go to:", url);
            window.location.href = url;
          });
        </script>

      </div>
      <div id="premade">
        <h2>â€¦ or try one of these:</h2>

        <h4>Propositional</h4>

        <ul>
          <li>a \to \top</li>
          <li>a \to a</li>
          <li>a \to b \to a</li>
          <li>a \to a \and a</li>
          <li>a \and b \to b \and a</li>
          <li>a \to b \to b \and a</li>
          <li>(a \to b \to c) \to (a \to b) \to a \to c</li>
        </ul>

        <h4>Classical theorems (and their double negations)</h4>

        <ul>
          <li>a \or (a \to \bot)</li>
          <li>((a \or (a \to \bot)) \to \bot) \to \bot</li>
          <li>((a \to b) \to a) \to a</li>
          <li>((((a \to b) \to a) \to a) \to \bot) \to \bot</li>
        </ul>

        <h4>Instantiation</h4>

        <ul>
          <li>\A [x, y] p (g x y) \to p (g x x)</li>
          <li>p j \to \E [x] p x</li>
          <li>(\A [x] p x) \to p k</li>
        </ul>

        <h4>Corner cases</h4>

        <ul>
          <li>(\A [x] \E [y] r x y) \to (\E [w] \A [z] r z w)</li>
          <li>(\E [w] \A [z] r z w) \to (\A [x] \E [y] r x y)</li>
          <li>(\A [x] p x) \to \E [y] p y</li>
          <li>(\A [x] p x) \to \A [y] p y</li>
        </ul>
      </div> <!-- premade -->
    </div> <!-- maincontent -->

  </body>
</html>
